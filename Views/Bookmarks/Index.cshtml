@model IEnumerable<TaskHabitBookmarkApp.Models.Bookmark>
@{
    ViewData["Title"] = "Bookmarks";
    var allTags = ViewBag.AllTags as IEnumerable<string> ?? Enumerable.Empty<string>();
    string? selectedTag = ViewBag.SelectedTag as string;
    string? q = ViewBag.Query as string;
    bool favorites = ViewBag.Favorites is bool b && b;
    string sort = ViewBag.Sort as string ?? "new";
}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">Bookmarks</h3>
  <a class="btn btn-primary" asp-action="Create">Add Bookmark</a>
</div>

<form method="get" class="row g-2 mb-3 align-items-center">
  <div class="col-md-4">
    <input class="form-control" type="search" name="q" placeholder="Search title/url/notes" value="@q" />
  </div>
  <div class="col-md-3">
    <select class="form-select" name="tag">
      <option value="">All tags</option>
      @foreach (var t in allTags)
      {
        <option value="@t" selected="@(selectedTag == t ? "selected" : null)">@t</option>
      }
    </select>
  </div>
  <div class="col-md-2">
    <select class="form-select" name="sort">
      <option value="new" selected="@(sort=="new" ? "selected" : null)">Newest</option>
      <option value="title" selected="@(sort=="title" ? "selected" : null)">Title</option>
      <option value="clicks" selected="@(sort=="clicks" ? "selected" : null)">Most clicked</option>
    </select>
  </div>
  <div class="col-md-2 d-flex align-items-center">
    <input class="form-check-input me-2" type="checkbox" id="fav" name="favorites" value="true" @(favorites ? "checked" : null) />
    <label for="fav" class="form-check-label">Favorites only</label>
  </div>
  <div class="col-md-1">
    <button class="btn btn-outline-secondary w-100">Go</button>
  </div>
</form>

@if (!Model.Any())
{
    <p class="text-muted">No bookmarks found.</p>
}
else
{
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
  @foreach (var bm in Model)
  {
    <div class="col">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <h6 class="card-title">@bm.Title</h6>
            <form asp-action="ToggleFavorite" asp-route-id="@bm.Id" method="post">
              <button class="btn btn-sm star-btn @(bm.IsFavorite ? "btn-warning" : "btn-outline-warning")" title="Toggle favorite">â˜…</button>
            </form>
          </div>
          <a asp-action="Visit" asp-route-id="@bm.Id" class="small text-truncate d-block">@bm.Url</a>
          <p class="small text-muted mb-2">@bm.Notes</p>
          <div class="d-flex flex-wrap gap-2 mb-2">
            @foreach (var tag in bm.BookmarkTags.Select(x => x.Tag.Name))
            {
                <a class="badge text-bg-secondary" asp-action="Index" asp-route-tag="@tag">@tag</a>
            }
          </div>
          <span class="badge text-bg-light">Clicks: @bm.Clicks</span>
        </div>
        <div class="card-footer d-flex justify-content-end gap-2">
          <a class="btn btn-sm btn-outline-primary" asp-action="Edit" asp-route-id="@bm.Id">Edit</a>
          <a class="btn btn-sm btn-outline-secondary" asp-action="Details" asp-route-id="@bm.Id">Details</a>
          <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@bm.Id">Delete</a>
        </div>
      </div>
    </div>
  }
  </div>
}
