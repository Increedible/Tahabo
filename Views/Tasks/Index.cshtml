@model IEnumerable<TaskHabitBookmarkApp.Models.TaskItem>
@{
    ViewData["Title"] = "Tasks";
    // Figure out checkbox state based on presence logic (matches controller)
    string sc = Context.Request.Query["sc"].ToString();
    bool showCompletedChecked = !string.IsNullOrEmpty(Context.Request.Query["showCompleted"]) || string.IsNullOrEmpty(sc);
}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">Tasks</h3>
  <a class="btn btn-primary" asp-action="Create">Add Task</a>
</div>

<form method="get" class="row g-2 mb-3 align-items-center">
  <div class="col-md-5">
    <input class="form-control" type="search" name="q" placeholder="Search title/notes" value="@Context.Request.Query["q"]" />
  </div>
  <div class="col-md-3">
    <select class="form-select" name="priority">
      <option value="">Any priority</option>
      @foreach (var p in Enum.GetValues<Priority>())
      {
        <option value="@p" selected="@(Context.Request.Query["priority"] == p.ToString() ? "selected" : null)">@p</option>
      }
    </select>
  </div>
  <div class="col-md-3 d-flex align-items-center">
    <!-- presence flag so we can distinguish an unchecked box vs initial load -->
    <input type="hidden" name="sc" value="1" />
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="showCompleted" name="showCompleted" value="true" @(showCompletedChecked ? "checked" : null) />
      <label for="showCompleted" class="form-check-label ms-2">Show completed</label>
    </div>
  </div>
  <div class="col-md-1">
    <button class="btn btn-outline-secondary w-100">Filter</button>
  </div>
</form>

<table class="table table-hover align-middle">
  <thead>
    <tr>
      <th>Title</th>
      <th>Due</th>
      <th>Priority</th>
      <th>Status</th>
      <th class="text-end">Actions</th>
    </tr>
  </thead>
  <tbody>
  @foreach (var t in Model)
  {
    <tr class="@(t.IsCompleted ? "table-light text-decoration-line-through" : "")">
      <td>@t.Title</td>
      <td>@(t.DueDate?.ToString("yyyy-MM-dd") ?? "-")</td>
      <td>@t.Priority</td>
      <td>@(t.IsCompleted ? "Done" : "Open")</td>
      <td class="text-end text-nowrap">
        <div class="d-inline-flex gap-1">
          <form asp-action="ToggleComplete" asp-route-id="@t.Id" method="post">
            <button class="btn btn-sm btn-outline-success">@((t.IsCompleted) ? "Mark open" : "Mark done")</button>
          </form>
          <a class="btn btn-sm btn-outline-primary" asp-action="Edit" asp-route-id="@t.Id">Edit</a>
          <a class="btn btn-sm btn-outline-secondary" asp-action="Details" asp-route-id="@t.Id">Details</a>
          <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@t.Id">Delete</a>
        </div>
      </td>
    </tr>
  }
  </tbody>
</table>
